import{R as Y,r as u,o as z,c as Z,b as l,w as r,V as w,f as C,S as P,aw as G,i as J,d as Q,g as X,U as h,T as t,Y as _,au as ee,t as ae,Z as le,ax as te,$ as oe,F as re,h as se,W as ne,a as ue,e as ie}from"./index-DM3VhAi8.js";import{c as de,a as A,e as me,f as pe,u as ve,b as v,V as ge}from"./index.esm-T3MrOO_k.js";import{b as E}from"./route-block-B_A1xBdJ.js";import{V as ce}from"./VRow-DTvxBjMF.js";import{V as T}from"./VCol-DUU_Oayl.js";import{V as fe,a as Ve}from"./VDataTable-BLi3qZ6G.js";import{V as be}from"./VContainer-BJzMzwk8.js";import{V as ye}from"./VCheckbox-CTMV2aCl.js";import{V as ke}from"./VTextarea-DRfeSj1F.js";import"./VList-CayGZef7.js";import"./ssrBoot-PdBFYS53.js";import"./VDivider-SyGGaYFo.js";import"./VChip-_ChbC7_y.js";import"./VSlideGroup-DJzPBOjD.js";const xe=se("h1",{class:"text-center"},"專輯管理",-1),we={__name:"sheetManage",setup(Ce){const{apiAuth:U}=ne(),$=Y(),D=u(null),n=u({open:!1,id:""}),I=o=>{o?(n.value.id=o._id,g.value.value=o.name,c.value.value=o.price,f.value.value=o.description,V.value.value=o.category,b.value.value=o.sell):n.value.id="",n.value.open=!0},R=()=>{n.value.open=!1,H(),D.value.deleteFileRecord()},q=["專輯","樂譜"],K=de({name:A().required("商品名稱必填"),price:me().typeError("商品價格格式錯誤").required("商品價格必填").min(0,"商品價格不能小於 0"),description:A().required("商品說明必填"),category:A().required("商品分類必填").test("isCategory","商品分類錯誤",o=>q.includes(o)),sell:pe()}),{handleSubmit:j,isSubmitting:S,resetForm:H}=ve({validationSchema:K,initialValues:{name:"",price:0,description:"",sell:!0}}),g=v("name"),c=v("price"),f=v("description"),V=v("category"),b=v("sell"),p=u([]),N=u([]),O=j(async o=>{var e,d,a;if(!((e=p.value[0])!=null&&e.error)&&!(n.value.id.length===0&&p.value.length<1))try{const s=new FormData;s.append("name",o.name),s.append("price",o.price),s.append("description",o.description),s.append("category",o.category),s.append("sell",o.sell),p.value.length>0&&s.append("image",p.value[0].file),n.value.id===""?await U.post("/product",s):await U.patch("/product/"+n.value.id,s),$({text:n.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"green"}}),R(),i(!0)}catch(s){console.log(s),$({text:((a=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:a.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),B=u(10),y=u([{key:"createdAt",order:"desc"}]),k=u(1),F=u([]),W=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"操作",align:"center",sortable:!1,key:"action"}],M=u(!0),L=u(0),x=u(""),i=async o=>{var e,d,a,s;o&&(k.value=1),M.value=!0;try{const{data:m}=await U.get("/product/all",{params:{page:k.value,itemsPerPage:B.value,sortBy:((e=y.value[0])==null?void 0:e.key)||"createdAt",sortOrder:((d=y.value[0])==null?void 0:d.order)||"desc",category:"樂譜",search:x.value}});F.value.splice(0,F.value.length,...m.result.data),L.value=m.result.total}catch(m){console.log(m),$({text:((s=(a=m==null?void 0:m.response)==null?void 0:a.data)==null?void 0:s.message)||"發生錯誤",snackbarProps:{color:"red"}})}M.value=!1};return i(),(o,e)=>{const d=ue("vue-file-agent");return z(),Z(re,null,[l(be,null,{default:r(()=>[l(ce,{class:"my-8"},{default:r(()=>[l(T,{cols:"12"},{default:r(()=>[xe]),_:1}),l(T,{cols:"12"},{default:r(()=>[l(w,{color:"green",onClick:e[0]||(e[0]=a=>I(null))},{default:r(()=>[C("新增商品")]),_:1})]),_:1}),l(T,{cols:"12"},{default:r(()=>[l(fe,{"items-per-page":B.value,"onUpdate:itemsPerPage":[e[4]||(e[4]=a=>B.value=a),e[7]||(e[7]=a=>i(!1))],"sort-by":y.value,"onUpdate:sortBy":[e[5]||(e[5]=a=>y.value=a),e[8]||(e[8]=a=>i(!1))],page:k.value,"onUpdate:page":[e[6]||(e[6]=a=>k.value=a),e[9]||(e[9]=a=>i(!1))],items:F.value,headers:W,loading:M.value,"items-length":L.value,search:x.value,hover:""},{top:r(()=>[l(P,{label:"搜尋",modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=a=>x.value=a),"append-icon":"mdi-magnify",onClickAppend:e[2]||(e[2]=a=>i(!0)),onKeydown:e[3]||(e[3]=G(a=>i(!0),["enter"]))},null,8,["modelValue"])]),"item.image":r(({value:a})=>[l(J,{src:a,height:"150px",contain:""},null,8,["src"])]),"item.sell":r(({value:a})=>[a?(z(),Q(ie,{key:0,icon:"mdi-check"})):X("",!0)]),"item.action":r(({item:a})=>[l(w,{icon:"mdi-pencil",variant:"text",color:"blue",onClick:s=>I(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),l(oe,{modelValue:n.value.open,"onUpdate:modelValue":e[17]||(e[17]=a=>n.value.open=a),persistent:"",width:"500"},{default:r(()=>[l(ge,{onSubmit:h(t(O),["prevent"]),disabled:t(S)},{default:r(()=>[l(_,null,{default:r(()=>[l(ee,null,{default:r(()=>[C(ae(n.value.id?"編輯商品":"新增商品"),1)]),_:1}),l(le,null,{default:r(()=>[l(P,{label:"名稱",modelValue:t(g).value.value,"onUpdate:modelValue":e[10]||(e[10]=a=>t(g).value.value=a),"error-messages":t(g).errorMessage.value},null,8,["modelValue","error-messages"]),l(P,{label:"價格",type:"number",min:"0",modelValue:t(c).value.value,"onUpdate:modelValue":e[11]||(e[11]=a=>t(c).value.value=a),"error-messages":t(c).errorMessage.value},null,8,["modelValue","error-messages"]),l(Ve,{label:"分類",items:q,modelValue:t(V).value.value,"onUpdate:modelValue":e[12]||(e[12]=a=>t(V).value.value=a),"error-messages":t(V).errorMessage.value},null,8,["modelValue","error-messages"]),l(ye,{label:"上架",modelValue:t(b).value.value,"onUpdate:modelValue":e[13]||(e[13]=a=>t(b).value.value=a),"error-messages":t(b).errorMessage.value},null,8,["modelValue","error-messages"]),l(ke,{label:"說明",modelValue:t(f).value.value,"onUpdate:modelValue":e[14]||(e[14]=a=>t(f).value.value=a),"error-messages":t(f).errorMessage.value},null,8,["modelValue","error-messages"]),l(d,{modelValue:p.value,"onUpdate:modelValue":e[15]||(e[15]=a=>p.value=a),"raw-model-value":N.value,"onUpdate:rawModelValue":e[16]||(e[16]=a=>N.value=a),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:D},null,8,["modelValue","raw-model-value"])]),_:1}),l(te,null,{default:r(()=>[l(w,{color:"red",loading:t(S),onClick:R},{default:r(()=>[C("取消")]),_:1},8,["loading"]),l(w,{color:"green",type:"submit",loading:t(S)},{default:r(()=>[C("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])],64)}}};typeof E=="function"&&E(we);export{we as default};
